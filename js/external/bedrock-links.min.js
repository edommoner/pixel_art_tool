const GH_API="https://api.github.com/repos/Mojang/bedrock-samples/releases?per_page=100";function parseReleases(json,{includePre:includePre=!1}={}){const out=[];for(const rel of json){if(!includePre&&rel.prerelease)continue;const tag=rel.tag_name||rel.name||"",ver=tag.replace(/^v/i,""),pageUrl=rel.html_url;let vrp=null,vbp=null;for(const a of rel.assets||[]){const n=(a.name||"").toLowerCase();!vrp&&n.includes("vanilla")&&n.includes("resource")&&n.endsWith(".zip")&&(vrp=a.browser_download_url),!vbp&&n.includes("vanilla")&&n.includes("behavior")&&n.endsWith(".zip")&&(vbp=a.browser_download_url)}(vrp||vbp)&&out.push({ver:ver,vrp:vrp,vbp:vbp,pageUrl:pageUrl,prerelease:!!rel.prerelease})}return out}export async function initBedrockLinks(){const sel=document.getElementById("bedrockVersion"),chk=document.getElementById("showPreviews"),aVRP=document.getElementById("linkBedrockVRP"),aVBP=document.getElementById("linkBedrockVBP"),aPage=document.getElementById("linkBedrockReleasePage");if(!(sel&&chk&&aVRP&&aVBP&&aPage))return;let list=[];async function reload(){try{const res=await fetch(GH_API,{headers:{Accept:"application/vnd.github+json"}});if(!res.ok)throw new Error("GitHub API error: "+res.status);const json=await res.json();list=parseReleases(json,{includePre:chk.checked}),sel.innerHTML=list.map((it,i)=>{const label=it.ver+(it.prerelease?" (preview)":""),selected=0===i?"selected":"";return`<option value="${i}" ${selected}>${label}</option>`}).join(""),apply()}catch(e){console.error(e),sel.innerHTML="<option>取得失敗</option>",aVRP.removeAttribute("href"),aVBP.removeAttribute("href"),aPage.href="https://github.com/Mojang/bedrock-samples/releases/latest"}}function apply(){const idx=parseInt(sel.value,10),item=list[idx];item&&(aVRP.href=item.vrp||item.pageUrl,aVRP.textContent=item.vrp?"Vanilla Resource Pack (.zip)":"Vanilla Resource Pack (リリースページへ)",aVBP.href=item.vbp||item.pageUrl,aVBP.textContent=item.vbp?"Vanilla Behavior Pack (.zip)":"Vanilla Behavior Pack (リリースページへ)",aPage.href=item.pageUrl)}sel.addEventListener("change",apply),chk.addEventListener("change",reload),await reload()}